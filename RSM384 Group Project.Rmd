---
title: "RSM 384 Group Project - NBA Defense and Size"
author: AliReza Rezvan, Melody Ashgriz, Jacob Wright, Jeffrey Chu, Tony Wang
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning=FALSE)
```

```{r, include = FALSE}
install.packages("tidyverse")
install.packages("RCurl")
install.packages("corrplot")
install.packages("dplyr")
```

```{r, include=FALSE}
library(tidyverse)
library(RCurl)
library(corrplot)
library(dplyr)
library(stats) #for LOESS
library(nnet) #for Multinomial logit
```

## Data Collection: Merging NBA Draft Combine Data and 1996-2024 Advanced Defence Statistics

**NBA Combine (2000-2024)**

```{r}
url <- getURL("https://raw.githubusercontent.com/jeffreychu48/RSM384/refs/heads/main/NBA_draft_combine.csv")
nba.combine <- read.csv(text = url)
nba.combine <- separate(nba.combine, col = PLAYER, into = c("Last Name", "First Name"), sep = ", ")
nba.combine$Player <- paste(nba.combine$`First Name`, nba.combine$`Last Name`, sep = " ")
nba.combine <- nba.combine %>%
  mutate(WGT = as.numeric(WGT))
nba.combine <- nba.combine %>% select (Player, HGT, WGT, BAR, STNDRCH, PAN, LPVERT, SPRINT, LANE)
colnames(nba.combine)[1] = "PLAYER"
```

**1996-2024 NBA Individual Player Advanced Defensive Stats**

```{r}
url <- getURL("https://raw.githubusercontent.com/jeffreychu48/RSM384/refs/heads/main/1996-2024%20NBA%20Player%20Advanced%20Defensive%20Stats.csv")
nba.9624.player.adv.def <- read.csv(text = url)
```

[Creating a Statistical Minimum (Total Minutes \> 1500) and removing Outliers]{.underline}

```{r}
nba.9624.player.adv.def <- nba.9624.player.adv.def %>%
  mutate(GP = as.numeric(GP), MIN = as.numeric(MIN), DEFRTG = as.numeric(DEFRTG)) %>%
  mutate(TOTALMIN = GP*MIN, TOTALMIN = as.numeric (TOTALMIN)) %>% 
  filter(TOTALMIN > 1500, YEAR < "2024", !PLAYER == "Aaron McKie", !PLAYER == "A.C. Green")
```

**Merging the Two Datasets**

```{r}
nba.9624.merged <- nba.9624.player.adv.def %>% merge(nba.combine, by = "PLAYER", all = FALSE)

#removing N/A variables from data
nba.9624.logit <- na.omit(nba.9624.merged)   
```

## Part 1: How has the emphasis on [physical attribute] for NBAâ€™s Top Defenders been changing over time?
### GLM Model

[Setup: Creating New Measures for Top and Bottom 10% of defenders]{.underline}

```{r}
#top and bottom 10% of defenders 
top_10_def <- quantile(nba.9624.logit$DEFRTG, 0.1,)
bottom_10_def <- quantile(nba.9624.logit$DEFRTG, 0.9,)

## creating new variables to the dataset 
nba.9624.logit <- nba.9624.logit %>%
          mutate(ABOVE_DEFNDR = ifelse(DEFRTG<mean(DEFRTG), 1, 0), ELITE = ifelse(DEFRTG<=top_10_def, 1, 0), BAD = ifelse(DEFRTG>=bottom_10_def, 1, 0))
```

**Logistic Regression (GLM)**

*Based on Defensive Rating, taking into account a player's: Height (HGT), Weight (WGT), Wingspan to Height Ratio (BAR), Hand Size - Length x Width (PAN), Max Vertical (LPVERT), 3/4 Basketball Court Sprint (SPRINT), and Agility around the Basketball Key (LANE)*

[Above Average Defenders]{.underline}
```{r}
fit.average <- glm(ABOVE_DEFNDR ~ HGT + WGT + BAR + PAN + LPVERT + SPRINT, data = nba.9624.logit, family = "binomial")    

summary(fit.average)
```

[Elite Defenders]{.underline}
```{r}
#logistic regression
fit.elite <- glm(ELITE ~ HGT + WGT + BAR + PAN + LPVERT + SPRINT, data = nba.9624.logit, family = "binomial")    

summary(fit.elite)
```

[Bad Defenders]{.underline}
```{r}
#logistic regression
fit.bad <- glm(BAD ~ HGT + WGT + BAR + PAN + LPVERT + SPRINT, data = nba.9624.logit, family = "binomial")    

summary(fit.bad)
```

**Scatterplots**
[Above Average Defenders]{.underline}
```{r}
nba.9624.logit <- nba.9624.logit %>% 
  mutate(expected_defrtg = fitted(fit.average)) 

nba.9624.logit <- nba.9624.logit %>% 
  mutate(above_avg_defrtg = ABOVE_DEFNDR - expected_defrtg)

##plot of above average defenders vs PAN
ggplot(nba.9624.logit, aes(PAN, above_avg_defrtg, color=HGT)) + geom_point()

##plot of above average defenders vs HGT
ggplot(nba.9624.logit, aes(HGT, above_avg_defrtg, color=HGT)) + geom_point()

##plot of above average defenders vs LPVERT
ggplot(nba.9624.logit, aes(LPVERT, above_avg_defrtg, color=HGT)) + geom_point()
```

[Elite Defenders]{.underline}
```{r}
nba.9624.logit <- nba.9624.logit %>% 
  mutate(expected_defrtg_elite = fitted(fit.elite)) 

nba.9624.logit <- nba.9624.logit %>% 
  mutate(above_elite_defrtg = ELITE - expected_defrtg_elite)

##plot of elite defenders vs BAR
ggplot(nba.9624.logit, aes(BAR, above_elite_defrtg, color=HGT)) + geom_point()
```

[Bad Defenders]{.underline}
```{r}
nba.9624.logit <- nba.9624.logit %>% 
  mutate(expected_defrtg_bad = fitted(fit.bad)) 

nba.9624.logit <- nba.9624.logit %>% 
  mutate(above_bad_defrtg = BAD - expected_defrtg_bad)

##plot of bad defenders vs PAN
ggplot(nba.9624.logit, aes(PAN, above_bad_defrtg, color=HGT)) + geom_point()
```


## Part 2: How does Physical Attributes correlate with Defensive Rating?
### Average (ALIREZA):

All Players, Not Top 10

Time Series:

Height

BAR

PAN

LPVERT

### Top 10 Defenders (JEFFREY):

Time Series:

Height

BAR

PAN

LPVERT


